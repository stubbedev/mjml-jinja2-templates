<mjml>
  <mj-body background-color="{{ design.body_bg_color }}">
    <mj-section background-color="{{ design.active_color }}">
      <mj-column>
        <mj-image
          width="{{ design.img_w_small }}"
          src="{{ design.shop_logo_url }}"
          href="{{ design.shop_domain }}"></mj-image>
      </mj-column>
    </mj-section>
    {% for product in products %}
      {% assign loop_index = loop.index0 | int %}
      {% if loop_index == 0 %}
        <mj-section background-color="{{ design.section_bg_color }}">
          <mj-column>
            <mj-image
              width="{{ design.img_w_smallish }}"
              href="{{ product.url }}"
              src="{{ product.image }}"></mj-image>
          </mj-column>
          <mj-column>
            <mj-text
              font-weight="bold"
              align="justify"
              font-size="{{ design.font_size_24 }}"
              color="{{ design.text_alt_color }}"
              font-family="{{ design.font_fam_title }}">{{ product.name }}</mj-text>
            {% if product.description %}
              <mj-text
                align="justify"
                font-size="{{ design.font_size_15 }}"
                color="{{ design.text_alt_color }}"
                font-family="{{ design.font_fam_title }}">
                {{ product.description | truncate(256) }}{% if product.description | length > 256 %}...{% endif %}
              </mj-text>
            {% endif %}
            <mj-button
              align="left"
              href="{{ product.url }}"
              background-color="{{ design.text_alt_color }}"
              border-radius="{{ design.border_rd_40 }}"
              font-family="{{ design.font_fam_title }}"
              font-size="{{ design.font_size_12 }}">{{ design.cta_text }}</mj-button>
          </mj-column>
        </mj-section>
      {% endif %}
    {% endfor %}

    <mj-section background-color="{{ design.section_bg_color }}">
      <mj-column>
        <mj-divider
          border-width="1px"
          border-style="dashed"
          border-color="{{ design.text_alt_color }}" />
      </mj-column>
    </mj-section>

    {% for product in products %}
      {% assign loop_index = loop.index0 - 1 %}
      {% assign end_row_index = loop.index0 | int %}
      {% assign row_start = (loop_index % items_per_row == 0) %}
      {% assign row_end = (loop.index0 % items_per_row == 0) %}
      {% assign loop_last = loop.last %}
      {% if loop.index0 > 0 %}
        {% if row_start %}
          <mj-section background-color="{{ design.section_bg_color }}">
          {% endif %}
          <mj-column vertical-align="bottom">
            <mj-image
              align="bottom"
              width="{{ design.img_w_smallish }}"
              href="{{ product.url }}"
              src="{{ product.image }}"></mj-image>
            <mj-text
              font-weight="bold"
              align="center"
              font-size="{{ design.font_size_16 }}"
              color="{{ design.text_alt_color }}"
              font-family="{{ design.font_fam_title }}">{{ product.name }}</mj-text>
            {% if product.description %}
              <mj-text
                align="justify"
                font-size="{{ design.font_size_12 }}"
                color="{{ design.text_alt_color }}"
                font-family="{{ design.font_fam_title }}">{{ product.description | truncate(128) }}{% if product.description | length > 128 %}...{% endif %}
              </mj-text>
            {% endif %}
            <mj-button
              background-color="{{ design.text_alt_color }}"
              border-radius="{{ design.border_rd_40 }}"
              font-family="{{ design.font_fam_title }}"
              href="{{ product.url }}"
              font-size="{{ design.font_size_12 }}">{{ design.cta_text }}</mj-button>
          </mj-column>
          {% if row_end or loop_last %}
          </mj-section>
        {% endif %}
      {% endif %}
    {% endfor %}
    <mj-section
      background-color="{{ design.active_color }}"
      padding-bottom="{{ design.pad_0 }}"
      font-family="{{ design.font_fam_section }}"
      padding-top="{{ design.pad_0 }}">
      <mj-column>
        <mj-image
          src="{{ design.shop_logo_url }}"
          href="{{ design.shop_domain }}"
          alt="Clerk logo"
          align="center"
          border="none"
          width="{{ design.img_w_small }}"
          padding-left="{{ design.pad_10 }}"
          padding-right="{{ design.pad_10 }}"
          padding-bottom="{{ design.pad_10 }}"
          padding-top="{{ design.pad_10 }}"></mj-image>
      </mj-column>
      <mj-column>
        <mj-button
          align="right"
          href="{{ design.shop_privacy_policy }}"
          background-color="transparent"
          color="{{ design.text_alt_color }}"
          font-size="{{ design.font_size_14 }}"
          padding-left="{{ design.pad_25 }}"
          padding-right="{{ design.pad_25 }}"
          padding-bottom="{{ design.pad_25 }}"
          padding-top="{{ design.pad_25 }}">
          Privacy policy
        </mj-button>
      </mj-column>
      <mj-column>
        <mj-social padding-top="{{ design.pad_20 }}">
          {% if social_facebook_url %}
            <mj-social-element name="facebook" href="{{ design.social_facebook_url }}"></mj-social-element>
          {% endif %}
          {% if social_twitter_url %}
            <mj-social-element name="twitter" href="{{ design.social_twitter_url }}"></mj-social-element>
          {% endif %}
          {% if social_google_url %}
            <mj-social-element name="google" href="{{ design.social_google_url }}"></mj-social-element>
          {% endif %}
          {% if social_pinterest_url %}
            <mj-social-element name="pinterest" href="{{ design.social_pinterest_url }}"></mj-social-element>
          {% endif %}
          {% if social_tumblr_url %}
            <mj-social-element name="tumblr" href="{{ design.social_tumblr_url }}"></mj-social-element>
          {% endif %}
          {% if social_linkedin_url %}
            <mj-social-element name="linkedin" href="{{ design.social_linkedin_url }}"></mj-social-element>
          {% endif %}
          {% if social_xing_url %}
            <mj-social-element name="xing" href="{{ design.social_xing_url }}"></mj-social-element>
          {% endif %}
        </mj-social>
      </mj-column>
    </mj-section>
  </mj-body>
</mjml>